<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
        <meta charset="UTF-8">
        <script>setInterval(function() {
    fetch('/test')
      .then(function (response) {
          return response.json();
      }).then(function (text) {
          if(text.changed === "yes"){console.log('query'); location.reload();}
          else {console.log("nonquery");}
      });
}, 1000);</script>
    </head>
    <body style="position: relative; padding: 0%; margin: 0;">
    <div id="particles-js" style="color: white; width: 100%; height:120px; background-size: cover; background-image: url({{ url_for('static',filename ='background.gif') }}); text-align:center; font-size: 40px;">
        <h1 style="position: absolute; padding: 3px; float: left; margin-left:2%; margin-top:10px; font-family: Arial, Helvetica, sans-serif">Here are your stats</h1>
    </div>
        <div>
            <canvas id="myChart" width="600" height="100">
            </canvas>
            <canvas id="donut" width="600" height="100">
            </canvas>
        {% if hasdataBar == "True" %}
        </div>
            <script>
                var ctx = document.getElementById('myChart').getContext('2d');
                var ylabel = {{ ylabl }};
                var xlabel = {{ xlabl | tojson }};
                var color = {{ color | tojson }};
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: xlabel,
                        datasets: [{
                            label: 'Hours spent online',
                            data: ylabel,
                            backgroundColor: color,
                            borderColor: color,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });
            </script>
            <div style="padding: 5px;">
                <ul style="float: left">
                    <li>
                        <h3>You have spent {{ sum }} hours on your computer</h3>
                    </li>
                    <li>
                        <h3>That is an average of {{ average }} hours per day</h3>
                    </li>
                    <li>
                        {% if user.screen_time_goal == 0 %}
                            <h3>You have not set any screen time goals yet</h3>
                        {% else %}
                            {% if user.screen_time_goal < sc_time %}
                                <h3>You have exceeded your screen time goals by {{ sc_time - user.screen_time_goal }}</h3>
                            {% else %}
                                <h3>You have {{ user.screen_time_goal - sc_time }} hours until you exceed your screen time goals.</h3>
                            {% endif %}
                        {% endif %}
                    </li>
                </ul>
                <form action="/" method="post">
                    <button name="returnHome" type="submit" style="width: 100px; height: 70px; float: right;">Go Home</button>
                </form>
            {% endif %}
            {% if hasdataDonut == "True"  %}
            <script>
                var ctx = document.getElementById('donut').getContext('2d');
                var donutXlabel = {{ donutXlabel | tojson}};
                var donutYlabel = {{ donutYlabel }};
                var myChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: donutXlabel,
                        datasets: [{
                            label: 'Hours spent online',
                            data: donutYlabel,
                            backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                            borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                            borderWidth: 1
                        }]
                    },
                });
            </script>
        </div>
        {% endif %}
        {% if hasdataDonut == "False" and hasdataBar == "False" %}
            <h1>You have no data at the moment, come back after you've run the local app.</h1>
            <form action="/" method="post">
                <button name="returnHome" type="submit" style="width: 100px; height: 70px; float: right;">Go Home</button>
            </form>
        {% endif %}
        <type="text/javascript" src="{{ url_for('static',filename ='particles.js') }}"></type=>
        <type="text/javascript" src="{{ url_for('static',filename ='app.js') }}"></type=>
    </body>
</html>